<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ MATHISON - Test de M√°quinas de Turing Reales</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .test-basic { border-left-color: #38a169; background: #f0fff4; }
        .test-intermediate { border-left-color: #4299e1; background: #f0f8ff; }
        .test-advanced { border-left-color: #ed8936; background: #fffaf0; }
        
        .test-case {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .test-result {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .success { background: #c6f6d5; color: #22543d; }
        .error { background: #fed7d7; color: #742a2a; }
        .running { background: #bee3f8; color: #2a4365; }
        
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover { background: #3182ce; }
        button:disabled { background: #a0aec0; cursor: not-allowed; }
        
        .console-output {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4299e1;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #38a169;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ MATHISON - Verificaci√≥n de M√°quinas de Turing Reales</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <p>Este test verifica que las m√°quinas de Turing est√°n funcionando <strong>realmente</strong>, no simulando.</p>
            <button onclick="runAllTests()" id="run-all-btn">üöÄ Ejecutar Todos los Tests</button>
            <button onclick="runQuickTest()" id="quick-test-btn">‚ö° Test R√°pido</button>
            <button onclick="clearResults()" id="clear-btn">üßπ Limpiar</button>
        </div>
        
        <!-- Estad√≠sticas -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="tests-passed">0</div>
                <div>Tests Exitosos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="tests-failed">0</div>
                <div>Tests Fallidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-machines">0</div>
                <div>M√°quinas Ejecutadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-steps">0</div>
                <div>Pasos Totales</div>
            </div>
        </div>
        
        <!-- Barra de progreso -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
        </div>
        
        <!-- Tests B√°sicos -->
        <div class="test-section test-basic">
            <h2>‚úÖ Tests B√°sicos - M√°quinas Completamente Reales</h2>
            <p>Estas m√°quinas ejecutan transiciones aut√©nticas con pocos estados.</p>
            
            <div class="test-case" id="test-1-plus-0">
                <h3>Test 1: Suma Simple (1 + 0)</h3>
                <p><strong>Esperado:</strong> 1 (decimal: 1) | <strong>Estados:</strong> ~5 | <strong>Pasos:</strong> ~6</p>
                <button onclick="runSingleTest('1 + 0', 'test-1-plus-0')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-1-plus-0"></div>
            </div>
            
            <div class="test-case" id="test-1-plus-1">
                <h3>Test 2: Suma con Acarreo (1 + 1)</h3>
                <p><strong>Esperado:</strong> 10 (decimal: 2) | <strong>Estados:</strong> ~6 | <strong>Pasos:</strong> ~8</p>
                <button onclick="runSingleTest('1 + 1', 'test-1-plus-1')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-1-plus-1"></div>
            </div>
            
            <div class="test-case" id="test-10-plus-01">
                <h3>Test 3: Multi-d√≠gito B√°sico (10 + 01)</h3>
                <p><strong>Esperado:</strong> 11 (decimal: 3) | <strong>Estados:</strong> ~8 | <strong>Pasos:</strong> ~15</p>
                <button onclick="runSingleTest('10 + 01', 'test-10-plus-01')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-10-plus-01"></div>
            </div>
        </div>
        
        <!-- Tests Intermedios -->
        <div class="test-section test-intermediate">
            <h2>üî¨ Tests Intermedios - Algoritmos Complejos</h2>
            <p>Algoritmos aut√©nticos con representaci√≥n unaria y m√∫ltiples fases.</p>
            
            <div class="test-case" id="test-101-plus-110">
                <h3>Test 4: Suma Compleja (101 + 110)</h3>
                <p><strong>Esperado:</strong> 1011 (decimal: 11) | <strong>Pasos:</strong> ~50-100</p>
                <button onclick="runSingleTest('101 + 110', 'test-101-plus-110')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-101-plus-110"></div>
            </div>
            
            <div class="test-case" id="test-subtract">
                <h3>Test 5: Resta (100 - 10)</h3>
                <p><strong>Esperado:</strong> 10 (decimal: 2) | <strong>Algoritmo:</strong> Representaci√≥n unaria</p>
                <button onclick="runSingleTest('100 - 10', 'test-subtract')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-subtract"></div>
            </div>
            
            <div class="test-case" id="test-multiply">
                <h3>Test 6: Multiplicaci√≥n (11 * 10)</h3>
                <p><strong>Esperado:</strong> 110 (decimal: 6) | <strong>Algoritmo:</strong> Sumas repetidas</p>
                <button onclick="runSingleTest('11 * 10', 'test-multiply')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-multiply"></div>
            </div>
            
            <div class="test-case" id="test-divide">
                <h3>Test 7: Divisi√≥n (1100 / 11)</h3>
                <p><strong>Esperado:</strong> 100 (decimal: 4) | <strong>Algoritmo:</strong> Restas repetidas</p>
                <button onclick="runSingleTest('1100 / 11', 'test-divide')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-divide"></div>
            </div>
        </div>
        
        <!-- Tests Avanzados -->
        <div class="test-section test-advanced">
            <h2>üöÄ Tests Avanzados - M√∫ltiples M√°quinas</h2>
            <p>Expresiones complejas que requieren m√∫ltiples m√°quinas de Turing.</p>
            
            <div class="test-case" id="test-parentheses">
                <h3>Test 8: Par√©ntesis Simples ((1 + 1) * 10)</h3>
                <p><strong>Esperado:</strong> 100 (decimal: 4) | <strong>M√°quinas:</strong> 2 | <strong>Pasos:</strong> ~40-80</p>
                <button onclick="runSingleTest('(1 + 1) * 10', 'test-parentheses')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-parentheses"></div>
            </div>
            
            <div class="test-case" id="test-nested">
                <h3>Test 9: Operaci√≥n Anidada (11 + (100 - 10))</h3>
                <p><strong>Esperado:</strong> 101 (decimal: 5) | <strong>M√°quinas:</strong> 2</p>
                <button onclick="runSingleTest('11 + (100 - 10)', 'test-nested')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-nested"></div>
            </div>
            
            <div class="test-case" id="test-complex">
                <h3>Test 10: Expresi√≥n Compleja ((10 + 11) * (11 - 1))</h3>
                <p><strong>Esperado:</strong> 1010 (decimal: 10) | <strong>M√°quinas:</strong> 3 | <strong>Pasos:</strong> ~100-200</p>
                <button onclick="runSingleTest('(10 + 11) * (11 - 1)', 'test-complex')">‚ñ∂Ô∏è Ejecutar</button>
                <div class="test-result" id="result-test-complex"></div>
            </div>
        </div>
        
        <!-- Consola de salida -->
        <div style="margin-top: 30px;">
            <h3>üìä Consola de Ejecuci√≥n</h3>
            <div class="console-output" id="console-output">
                Listo para ejecutar tests...\n
                üí° Los tests verifican que las m√°quinas de Turing ejecuten REALMENTE, no que simulen.\n
            </div>
        </div>
        
        <!-- Resumen final -->
        <div id="final-summary" style="margin-top: 30px; padding: 20px; background: #edf2f7; border-radius: 10px; display: none;">
            <h3>üìà Resumen de Resultados</h3>
            <div id="summary-content"></div>
        </div>
    </div>

    <!-- Scripts necesarios -->
    <script src="js/turing-machine.js"></script>
    <script src="js/binary-operations.js"></script>
    <script src="js/expression-parser.js"></script>
    
    <script>
        // Variables globales para estad√≠sticas
        let testStats = {
            passed: 0,
            failed: 0,
            totalMachines: 0,
            totalSteps: 0,
            currentTest: 0,
            totalTests: 10
        };
        
        let testResults = [];
        
        function log(message) {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `[${timestamp}] ${message}\n`;
            console.scrollTop = console.scrollHeight;
        }
        
        function updateStats() {
            document.getElementById('tests-passed').textContent = testStats.passed;
            document.getElementById('tests-failed').textContent = testStats.failed;
            document.getElementById('total-machines').textContent = testStats.totalMachines;
            document.getElementById('total-steps').textContent = testStats.totalSteps;
            
            const progress = (testStats.currentTest / testStats.totalTests) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }
        
        async function runSingleTest(expression, testId) {
            const resultElement = document.getElementById(`result-${testId}`);
            resultElement.className = 'test-result running';
            resultElement.textContent = 'üîÑ Ejecutando m√°quina de Turing...';
            
            log(`üß™ Iniciando test: ${expression}`);
            
            try {
                // Evaluar usando m√°quinas de Turing reales
                const evaluation = ExpressionParser.validateExpression(expression);
                
                if (!evaluation.success) {
                    throw new Error(evaluation.error);
                }
                
                // Verificar que se ejecutaron m√°quinas reales
                const machines = evaluation.machines || [];
                const totalSteps = machines.reduce((sum, m) => sum + (m.machine.history.length || 0), 0);
                
                // Validaciones espec√≠ficas para m√°quinas reales
                let realMachineCount = 0;
                let authenticSteps = 0;
                
                for (const machineInfo of machines) {
                    const machine = machineInfo.machine;
                    
                    // Verificar que es una m√°quina real
                    if (machine.states && machine.transitions && machine.history) {
                        realMachineCount++;
                        authenticSteps += machine.history.length;
                        
                        // Verificar transiciones aut√©nticas
                        const hasRealTransitions = machine.transitions.size > 0;
                        const hasValidStates = machine.states.size > 1;
                        const hasHistory = machine.history.length > 0;
                        
                        if (!hasRealTransitions || !hasValidStates || !hasHistory) {
                            log(`‚ö†Ô∏è M√°quina ${machineInfo.operation} no parece ser aut√©ntica`);
                        } else {
                            log(`‚úÖ M√°quina ${machineInfo.operation}: ${machine.states.size} estados, ${machine.transitions.size} transiciones, ${machine.history.length} pasos`);
                        }
                    }
                }
                
                // Verificar resultado correcto
                const expectedResults = {
                    '1 + 0': { binary: '1', decimal: '1' },
                    '1 + 1': { binary: '10', decimal: '2' },
                    '10 + 01': { binary: '11', decimal: '3' },
                    '101 + 110': { binary: '1011', decimal: '11' },
                    '100 - 10': { binary: '10', decimal: '2' },
                    '11 * 10': { binary: '110', decimal: '6' },
                    '1100 / 11': { binary: '100', decimal: '4' },
                    '(1 + 1) * 10': { binary: '100', decimal: '4' },
                    '11 + (100 - 10)': { binary: '101', decimal: '5' },
                    '(10 + 11) * (11 - 1)': { binary: '1010', decimal: '10' }
                };
                
                const expected = expectedResults[expression];
                const actual = evaluation.result;
                
                const isCorrect = expected && 
                    actual.binary === expected.binary && 
                    actual.decimal === expected.decimal;
                
                if (isCorrect && realMachineCount > 0 && authenticSteps > 0) {
                    // TEST EXITOSO
                    resultElement.className = 'test-result success';
                    resultElement.innerHTML = `
                        ‚úÖ <strong>√âXITO</strong><br>
                        Resultado: ${actual.binary} (${actual.decimal})<br>
                        M√°quinas reales: ${realMachineCount}<br>
                        Pasos aut√©nticos: ${authenticSteps}
                    `;
                    
                    testStats.passed++;
                    testStats.totalMachines += realMachineCount;
                    testStats.totalSteps += authenticSteps;
                    
                    log(`üéâ Test exitoso: ${expression} = ${actual.binary}`);
                    
                    testResults.push({
                        expression,
                        status: 'success',
                        machines: realMachineCount,
                        steps: authenticSteps,
                        result: actual
                    });
                    
                } else {
                    // TEST FALLIDO
                    resultElement.className = 'test-result error';
                    resultElement.innerHTML = `
                        ‚ùå <strong>FALLO</strong><br>
                        ${!isCorrect ? `Resultado incorrecto: ${actual.binary} ‚â† ${expected?.binary}` : ''}<br>
                        ${realMachineCount === 0 ? 'No se ejecutaron m√°quinas reales' : ''}<br>
                        ${authenticSteps === 0 ? 'No se registraron pasos aut√©nticos' : ''}
                    `;
                    
                    testStats.failed++;
                    log(`‚ùå Test fallido: ${expression}`);
                    
                    testResults.push({
                        expression,
                        status: 'failed',
                        machines: realMachineCount,
                        steps: authenticSteps,
                        error: 'Validaci√≥n fallida'
                    });
                }
                
            } catch (error) {
                // ERROR EN EJECUCI√ìN
                resultElement.className = 'test-result error';
                resultElement.innerHTML = `‚ùå <strong>ERROR:</strong> ${error.message}`;
                
                testStats.failed++;
                log(`üí• Error en test ${expression}: ${error.message}`);
                
                testResults.push({
                    expression,
                    status: 'error',
                    error: error.message
                });
            }
            
            testStats.currentTest++;
            updateStats();
        }
        
        async function runAllTests() {
            const tests = [
                '1 + 0',
                '1 + 1', 
                '10 + 01',
                '101 + 110',
                '100 - 10',
                '11 * 10',
                '1100 / 11',
                '(1 + 1) * 10',
                '11 + (100 - 10)',
                '(10 + 11) * (11 - 1)'
            ];
            
            const testIds = [
                'test-1-plus-0',
                'test-1-plus-1',
                'test-10-plus-01', 
                'test-101-plus-110',
                'test-subtract',
                'test-multiply',
                'test-divide',
                'test-parentheses',
                'test-nested',
                'test-complex'
            ];
            
            // Resetear estad√≠sticas
            testStats = {
                passed: 0,
                failed: 0,
                totalMachines: 0,
                totalSteps: 0,
                currentTest: 0,
                totalTests: tests.length
            };
            
            testResults = [];
            
            log('üöÄ Iniciando bater√≠a completa de tests...');
            document.getElementById('run-all-btn').disabled = true;
            
            for (let i = 0; i < tests.length; i++) {
                await runSingleTest(tests[i], testIds[i]);
                // Peque√±a pausa para visualizaci√≥n
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            document.getElementById('run-all-btn').disabled = false;
            showFinalSummary();
            
            log(`\nüèÅ Bater√≠a de tests completada:`);
            log(`   ‚úÖ Exitosos: ${testStats.passed}/${testStats.totalTests}`);
            log(`   ‚ùå Fallidos: ${testStats.failed}/${testStats.totalTests}`);
            log(`   ü§ñ M√°quinas ejecutadas: ${testStats.totalMachines}`);
            log(`   üë£ Pasos totales: ${testStats.totalSteps}`);
        }
        
        async function runQuickTest() {
            log('‚ö° Ejecutando test r√°pido (solo operaciones b√°sicas)...');
            
            const quickTests = ['1 + 0', '1 + 1', '10 + 01'];
            const quickIds = ['test-1-plus-0', 'test-1-plus-1', 'test-10-plus-01'];
            
            document.getElementById('quick-test-btn').disabled = true;
            
            for (let i = 0; i < quickTests.length; i++) {
                await runSingleTest(quickTests[i], quickIds[i]);
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            document.getElementById('quick-test-btn').disabled = false;
            log('‚ö° Test r√°pido completado');
        }
        
        function clearResults() {
            // Limpiar resultados
            const resultElements = document.querySelectorAll('.test-result');
            resultElements.forEach(el => {
                el.className = 'test-result';
                el.textContent = '';
            });
            
            // Resetear estad√≠sticas
            testStats = {
                passed: 0,
                failed: 0,
                totalMachines: 0,
                totalSteps: 0,
                currentTest: 0,
                totalTests: 10
            };
            
            testResults = [];
            updateStats();
            
            // Limpiar consola
            document.getElementById('console-output').innerHTML = 'Consola limpiada. Listo para nuevos tests...\n';
            
            // Ocultar resumen
            document.getElementById('final-summary').style.display = 'none';
            
            log('üßπ Resultados limpiados');
        }
        
        function showFinalSummary() {
            const summaryDiv = document.getElementById('final-summary');
            const contentDiv = document.getElementById('summary-content');
            
            const successRate = (testStats.passed / testStats.totalTests * 100).toFixed(1);
            const avgStepsPerMachine = testStats.totalMachines > 0 ? 
                (testStats.totalSteps / testStats.totalMachines).toFixed(1) : 0;
            
            let summaryHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: ${successRate >= 80 ? '#38a169' : '#f56565'};">${successRate}%</div>
                        <div>Tasa de √âxito</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: #4299e1;">${testStats.totalMachines}</div>
                        <div>M√°quinas Reales</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: #805ad5;">${avgStepsPerMachine}</div>
                        <div>Pasos Promedio</div>
                    </div>
                </div>
                
                <h4>üìã Detalle de Resultados:</h4>
                <div style="max-height: 200px; overflow-y: auto;">
            `;
            
            testResults.forEach(result => {
                const statusIcon = result.status === 'success' ? '‚úÖ' : '‚ùå';
                const statusColor = result.status === 'success' ? '#38a169' : '#f56565';
                
                summaryHTML += `
                    <div style="margin: 8px 0; padding: 8px; background: white; border-radius: 6px; border-left: 3px solid ${statusColor};">
                        ${statusIcon} <strong>${result.expression}</strong>
                        ${result.status === 'success' ? 
                            ` ‚Üí ${result.result.binary} (${result.machines} m√°quinas, ${result.steps} pasos)` :
                            ` ‚Üí Error: ${result.error || 'Fallo en validaci√≥n'}`
                        }
                    </div>
                `;
            });
            
            summaryHTML += '</div>';
            
            if (successRate >= 80) {
                summaryHTML += `
                    <div style="margin-top: 15px; padding: 15px; background: #c6f6d5; border-radius: 8px; text-align: center;">
                        üéâ <strong>¬°Excelente!</strong> Las m√°quinas de Turing est√°n funcionando correctamente.
                        Esto confirma que tienes implementaciones REALES, no simulaciones.
                    </div>
                `;
            } else {
                summaryHTML += `
                    <div style="margin-top: 15px; padding: 15px; background: #fed7d7; border-radius: 8px; text-align: center;">
                        ‚ö†Ô∏è <strong>Atenci√≥n:</strong> Algunas m√°quinas no est√°n funcionando correctamente.
                        Revisa la implementaci√≥n en binary-operations.js y turing-machine.js.
                    </div>
                `;
            }
            
            contentDiv.innerHTML = summaryHTML;
            summaryDiv.style.display = 'block';
        }
        
        // Inicializar
        updateStats();
        log('ü§ñ Sistema de testing de m√°quinas de Turing listo');
        log('üí° Haz clic en "Test R√°pido" para verificar operaciones b√°sicas');
    </script>
</body>
</html>